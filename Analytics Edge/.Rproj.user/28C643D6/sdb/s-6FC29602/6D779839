{
    "contents" : "# k-means clustering k=3\n\neBayTrain5 <- eBayTrain3\n\n\nlibrary(Hmisc)\ncutsTrain <- cut2(eBayTrain5$startprice,g=4,onlycuts=TRUE)\neBayTrain5$pricequartile <- as.numeric(cut2(eBayTrain5$startprice,cuts=cutsTrain))\n# eBayTrain3$pricequartile <- as.numeric(cut2(eBayTrain5$startprice,cuts=cutsTrain))\n\n# eBayTrain5$startprice <- NULL\neBayTrain5$UniqueID <- NULL\neBayTrain5$sold <- NULL\n\neBayTrain5$biddable <- as.numeric(eBayTrain5$biddable)\neBayTrain5$condition <- as.numeric(eBayTrain5$condition)\neBayTrain5$storage <- as.numeric(eBayTrain5$storage)\neBayTrain5$productline <- as.numeric(eBayTrain5$storage)\neBayTrain5$Dexcel <- as.numeric(eBayTrain5$Dexcel)\neBayTrain5$Dscratch <- as.numeric(eBayTrain5$Dscratch)\neBayTrain5$pricequartile <- as.numeric(eBayTrain5$pricequartile)\n\neBayTrain5mat <- as.matrix(eBayTrain5)\n       \nset.seed(144)\nkm = kmeans(eBayTrain5mat, centers = 3)\n\nlibrary(flexclust)\nkm.kcca <- as.kcca(km,eBayTrain5)\nclusterTrain <- predict(km.kcca) #same as clusterTrain <-km$cluster\n\n\nkmcluster1Train <- subset(eBayTrain3,clusterTrain==1) #228obs\nkmcluster2Train <- subset(eBayTrain3,clusterTrain==2) #686obs\nkmcluster3Train <- subset(eBayTrain3,clusterTrain==3) #947obs\n\nLogRegkmClust1 <- glm(sold~. -UniqueID,data=kmcluster1Train,family=\"binomial\")\nLogRegkmClust2 <- glm(sold~. -UniqueID,data=kmcluster2Train,family=\"binomial\")\nLogRegkmClust3 <- glm(sold~. -UniqueID,data=kmcluster3Train,family=\"binomial\")\n\npredLR_kmC1 <- predict(LogRegkmClust1,type=\"response\")\nresLR_kmC1 <- table(kmcluster1Train$sold,predLR_kmC1>cutoff)\naccLR_kmC1 <- (resLR_kmC1[1,1]+resLR_kmC1[2,2])/sum(resLR_kmC1)\n\npredLR_kmC2 <- predict(LogRegkmClust2,type=\"response\")\nresLR_kmC2 <- table(kmcluster2Train$sold,predLR_kmC2>cutoff)\naccLR_kmC2 <- (resLR_kmC2[1,1]+resLR_kmC2[2,2])/sum(resLR_kmC2)\n\n\npredLR_kmC3 <- predict(LogRegkmClust3,type=\"response\")\nresLR_kmC3 <- table(kmcluster3Train$sold,predLR_kmC3>cutoff)\naccLR_kmC3 <- (resLR_kmC3[1,1]+resLR_kmC3[2,2])/sum(resLR_kmC3)\n\n#combine 3 results for the Training Set.\n\ntemp1 <- cbind(kmcluster1Train$UniqueID,as.numeric(predLR_kmC1))\ntemp2 <- cbind(kmcluster2Train$UniqueID,as.numeric(predLR_kmC2))\ntemp3 <- cbind(kmcluster3Train$UniqueID,as.numeric(predLR_kmC3))\n\ntemp <- rbind(temp1,temp2,temp3)\nans <- temp[order(temp[,1]),]\nremove(temp1); remove(temp2);remove(temp3);remove(temp)\n\n# Train set AUC \nlibrary(ROCR)\nprint(\"Train set AUC for clustering\")\nROCRpred = prediction(ans[,2], eBayTrain3$sold)\nprint(as.numeric(performance(ROCRpred, \"auc\")@y.values))\n\n\n# Prepare the Test Set\neBayTest5 <- eBayTest3\neBayTest5$pricequartile <- as.numeric(cut2(eBayTest5$startprice,cuts=cutsTrain))\neBayTest5$UniqueID <- NULL\neBayTest5$description <- NULL\neBayTest5$cellular <- NULL\neBayTest5$carrier <- NULL\neBayTest5$color <- NULL\n\neBayTest5$biddable <- as.numeric(eBayTest5$biddable)\neBayTest5$condition <- as.numeric(eBayTest5$condition)\neBayTest5$storage <- as.numeric(eBayTest5$storage)\neBayTest5$productline <- as.numeric(eBayTest5$storage)\neBayTest5$Dexcel <- as.numeric(eBayTest5$Dexcel)\neBayTest5$Dscratch <- as.numeric(eBayTest5$Dscratch)\neBayTest5$pricequartile <- as.numeric(eBayTest5$pricequartile)\n\nclusterTest <- predict(km.kcca,newdata=eBayTest5)\n\nkmcluster1Test <- subset(eBayTest3,clusterTest==1) \nkmcluster2Test <- subset(eBayTest3,clusterTest==2) \nkmcluster3Test <- subset(eBayTest3,clusterTest==3) \n\npredTestLR_kmC1 <- predict(LogRegkmClust1,newdata=kmcluster1Test,type=\"response\")\npredTestLR_kmC2 <- predict(LogRegkmClust2,newdata=kmcluster2Test,type=\"response\")\npredTestLR_kmC3 <- predict(LogRegkmClust3,newdata=kmcluster3Test,type=\"response\")\n\ntemp1 <- cbind(kmcluster1Test$UniqueID,as.numeric(predTestLR_kmC1))\ntemp2 <- cbind(kmcluster2Test$UniqueID,as.numeric(predTestLR_kmC2))\ntemp3 <- cbind(kmcluster3Test$UniqueID,as.numeric(predTestLR_kmC3))\n\ntemp <- rbind(temp1,temp2,temp3)\nans <- temp[order(temp[,1]),]\nremove(temp1); remove(temp2);remove(temp3);remove(temp4);remove(temp5)\nremove(temp)\n# table with predTestLR3\n# FALSE  TRUE \n# 36   762 \n\nsubmission  <-  data.frame(UniqueID = eBayTest$UniqueID, Probability1 = ans[,2])\nwrite.csv(submission,\"submission.csv\",row.names=FALSE)\n\n\n",
    "created" : 1438656171541.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3268381445",
    "id" : "6D779839",
    "lastKnownWriteTime" : 1437291425,
    "path" : "~/coursera/Analytics Edge/Kaggle_MIT3.R",
    "project_path" : "Kaggle_MIT3.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}